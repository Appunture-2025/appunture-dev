% ----------------------------------------------------------
% Capítulo 4 - TECNOLOGIAS E ARQUITETURA DO SISTEMA
% ----------------------------------------------------------
\chapter{TECNOLOGIAS E ARQUITETURA DO SISTEMA} \label{cha:tecnologias}

Este capítulo apresenta o \textit{stack} tecnológico utilizado no desenvolvimento do \textit{Appunture}, detalhando a arquitetura do sistema, as tecnologias empregadas e as decisões técnicas que fundamentam a implementação da solução.

\section{VISÃO GERAL DA ARQUITETURA} \label{sec:visao_arquitetura}

O \textit{Appunture} foi desenvolvido seguindo uma arquitetura híbrida distribuída, composta por quatro camadas principais:

\begin{itemize}
    \item \textbf{Aplicativo Móvel (React Native + Expo)}: Interface principal do usuário com estratégia ``\textit{Offline-First}'';
    \item \textbf{API Backend (Java + Spring Boot)}: Servidor de aplicação responsável pela lógica de negócio, sincronização e Inteligência Artificial;
    \item \textbf{Ferramentas de Apoio (Python/HTML)}: Scripts de migração de dados e ferramenta de mapeamento de pontos (Point Mapper).
\end{itemize}

Esta arquitetura garante alta disponibilidade, performance otimizada e experiência consistente mesmo em ambientes com conectividade limitada.

\subsection{Diagrama de Arquitetura}

O \textit{Appunture} foi desenvolvido seguindo uma arquitetura híbrida e modular, que integra funcionalidades \textit{offline} e \textit{online} para garantir alta disponibilidade, desempenho e usabilidade mesmo em ambientes com conexão limitada ou instável.

\figura{DIAGRAMA DE ARQUITETURA DO SISTEMA}{0.8}{fig/arquitetura.png}{Os autores (2025)}{arquitetura}{}{}

\section{ARQUITETURA HÍBRIDA (OFFLINE + ONLINE)} \label{sec:arquitetura_hibrida}

\subsection{Funcionamento Offline}

O aplicativo móvel foi projetado com estratégia ``\textit{offline-first}'', garantindo que as funcionalidades de navegação e consulta de dados funcionem independentemente da conectividade:

\textbf{Banco de Dados Local (SQLite):}
\begin{itemize}
    \item Armazena todos os 361 pontos de acupuntura dos meridianos principais;
    \item Contém pontos extras, sintomas e suas relações terapêuticas;
    \item Mantém favoritos do usuário;
    \item Estrutura otimizada para consultas rápidas;
    \item Garantia de performance instantânea e independência de rede.
\end{itemize}

\textbf{Nota:} A busca inteligente por sintomas utilizando o assistente de IA requer conexão com a internet. Quando \textit{offline}, o usuário pode navegar manualmente pelo atlas anatômico e acessar os detalhes dos pontos já sincronizados.

\textbf{Sistema de Armazenamento Seguro:}
\begin{itemize}
    \item \textbf{SecureStore}: Armazenamento criptografado para tokens de autenticação JWT;
    \item \textbf{AsyncStorage}: Persistência de configurações, preferências e dados de sessão;
    \item \textit{Cache} de imagens e recursos visuais através do sistema de arquivos;
    \item Persistência de estado via \textit{middleware persist} do Zustand integrado ao AsyncStorage.
\end{itemize}

\subsection{Sincronização Inteligente}

Quando conectado à internet, o sistema implementa sincronização bidirecional automática:

\textbf{Sincronização Descendente (Backend $\rightarrow$ Mobile):}
\begin{itemize}
    \item Atualização automática de dados do atlas;
    \item \textit{Download} incremental baseado em versionamento;
    \item Compressão de dados para otimizar transferência;
    \item Validação de integridade dos dados recebidos.
\end{itemize}

\textbf{Sincronização Ascendente (Mobile $\rightarrow$ Backend):}
\begin{itemize}
    \item \textit{Upload} de favoritos do usuário;
    \item \textit{Backup} automático de preferências;
    \item \textit{Logs} de uso para análise de performance;
    \item Controle de conflitos com \textit{timestamp}.
\end{itemize}

\section{STACK TECNOLÓGICO DETALHADO} \label{sec:stack}

\subsection{Frontend Mobile (React Native + Expo)}

Segundo a documentação oficial \cite{reactnative2023}, ``React Native combina as melhores partes do desenvolvimento nativo com React, uma biblioteca JavaScript de ponta para construção de interfaces de usuário''.

\textbf{React Native 0.79.6 com Expo SDK 53:}
\begin{itemize}
    \item \textit{Framework} multiplataforma para desenvolvimento nativo;
    \item Expo Router 5.1.7 para navegação baseada em arquivos;
    \item Renderização otimizada de SVGs através do \texttt{react-native-svg} 15.11.2;
    \item TypeScript 5.8.3 para tipagem estática e maior confiabilidade;
    \item Nova arquitetura React Native habilitada (\texttt{newArchEnabled}).
\end{itemize}

\textbf{Atlas Anatômico Digital:}
\begin{itemize}
    \item 15 visualizações vetoriais (SVG) de alta fidelidade;
    \item Organizadas por meridianos e vistas (frontal e posterior);
    \item Zoom sem perda de qualidade;
    \item Interação precisa (toque) em áreas pequenas;
    \item Carga sob demanda das imagens para otimizar memória.
\end{itemize}

\subsection{Backend API (Java + Spring Boot)}

Segundo \citeonline{walls2016}, ``Spring Boot muda a forma como desenvolvemos aplicações Spring, oferecendo configuração automática e eliminando a necessidade de configurações XML complexas''.

\textbf{Java 17 LTS e Spring Boot 3.2+:}
\begin{itemize}
    \item Linguagem robusta, fortemente tipada e de alta performance;
    \item \textit{Framework} que simplifica o desenvolvimento de aplicações Java;
    \item Arquitetura baseada em injeção de dependência e inversão de controle;
    \item Integração nativa com serviços Google Cloud.
\end{itemize}

\textbf{Spring AI - Integração com Inteligência Artificial:}

Segundo a documentação oficial \cite{springai2024}, Spring AI é o \textit{framework} oficial do ecossistema Spring para integração com modelos de linguagem de grande escala (LLMs).

\begin{itemize}
    \item \textit{Framework} oficial do Spring para integração com modelos de IA;
    \item Suporte nativo a múltiplos provedores de LLM;
    \item Abstração unificada para chamadas de API de IA;
    \item Gerenciamento de \textit{prompts} e contexto.
\end{itemize}

\textbf{Spring Security + Firebase Auth:}

Segundo a documentação do Firebase \cite{firebase2024}, o Firebase Authentication fornece serviços de backend, SDKs fáceis de usar e bibliotecas de UI prontas para autenticar usuários em aplicativos.

\begin{itemize}
    \item Integração com Firebase Authentication para gestão de identidades;
    \item Validação de \textit{tokens} JWT no \textit{backend};
    \item Controle de acesso baseado em \textit{roles} (RBAC);
    \item Suporte a autenticação biométrica no dispositivo móvel.
\end{itemize}

\subsection{Banco de Dados}

\textbf{SQLite (Mobile - Local):}
\begin{itemize}
    \item Banco relacional embarcado de alta performance;
    \item Zero configuração e manutenção;
    \item ACID \textit{compliance} para integridade dos dados;
    \item Tamanho reduzido ideal para mobile.
\end{itemize}

\textbf{Google Cloud Firestore (Backend - Remoto):}
\begin{itemize}
    \item Banco de dados NoSQL flexível, escalável e de alta performance;
    \item Sincronização em tempo real e suporte \textit{offline} nativo;
    \item Modelo de dados baseado em documentos e coleções;
    \item Integração perfeita com o ecossistema Firebase e Google Cloud.
\end{itemize}

\section{INTELIGÊNCIA ARTIFICIAL E SUPORTE À CONSULTA} \label{sec:ia}

Diferente de abordagens tradicionais baseadas apenas em palavras-chave, o \textit{Appunture} implementa um sistema de RAG (\textit{Retrieval-Augmented Generation}) no \textit{backend}, oferecendo suporte contextualizado para consulta de informações.

\subsection{Arquitetura RAG (Retrieval-Augmented Generation)}

A arquitetura RAG (\textit{Retrieval-Augmented Generation}) foi introduzida por \citeonline{lewis2020} como uma abordagem que combina a recuperação de informações com a geração de texto, melhorando significativamente a precisão e confiabilidade das respostas em tarefas de conhecimento intensivo.

\textbf{Modelo de IA:}

O Google Gemini 1.5 Flash \cite{gemini2024} é um modelo de linguagem multimodal otimizado para respostas rápidas e contextualizadas.

\begin{itemize}
    \item Google Gemini 1.5 Flash via Spring AI;
    \item Modelo otimizado para respostas rápidas e contextualizadas;
    \item Integração nativa com o ecossistema Google Cloud.
\end{itemize}

\textbf{Funcionamento do Sistema:}
\begin{enumerate}
    \item O sistema intercepta a pergunta do usuário;
    \item Busca contexto relevante na base de dados (pontos e sintomas relacionados);
    \item Envia um \textit{prompt} enriquecido para o modelo de IA;
    \item Retorna respostas precisas e contextualizadas, baseadas nos dados validados do sistema.
\end{enumerate}

\textbf{Benefícios da Abordagem RAG:}
\begin{itemize}
    \item Respostas baseadas em dados validados do sistema;
    \item Redução significativa de alucinações do modelo;
    \item Maior confiabilidade das informações apresentadas;
    \item Contextualização específica para acupuntura;
    \item Rastreabilidade das fontes utilizadas nas respostas.
\end{itemize}

\subsection{Integração com Spring AI}

O \autoref{qua:springai} apresenta um exemplo simplificado da integração com Spring AI para o assistente de acupuntura:

\begin{quadro}[htb]
\caption{Exemplo de integração Spring AI}
\label{qua:springai}
\centering
\footnotesize
\begin{verbatim}
@Service
public class AcupunctureAssistantService {
    
    private final ChatClient chatClient;
    private final PointRepository pointRepository;
    
    public String getEducationalAssistance(String userQuestion) {
        // Busca contexto relevante na base de dados
        List<Point> relevantPoints = 
            pointRepository.findBySymptoms(userQuestion);
        
        // Monta prompt enriquecido com contexto
        String enrichedPrompt = buildPromptWithContext(
            userQuestion, relevantPoints);
        
        // Chama o modelo de IA via Spring AI
        return chatClient.prompt()
            .user(enrichedPrompt)
            .call()
            .content();
    }
}
\end{verbatim}
\fonte{Os autores (2025)}
\end{quadro}

\section{FERRAMENTAS DE DESENVOLVIMENTO E MAPEAMENTO} \label{sec:ferramentas}

Para garantir a precisão da localização dos pontos de acupuntura sobre o atlas anatômico digital, foi desenvolvida uma ferramenta interna denominada ``\textit{Point Mapper}''.

\subsection{Point Mapper - Ferramenta de Mapeamento}

\textbf{Características:}
\begin{itemize}
    \item Interface Web para visualização dos 15 SVGs do atlas;
    \item Sistema de coordenadas percentuais para garantir responsividade;
    \item Funcionalidades de zoom e pan para precisão no posicionamento;
    \item Exportação de dados em formato JSON para integração com o banco;
    \item Validação cruzada com descrições anatômicas dos pontos.
\end{itemize}

\textbf{Sistema de Coordenadas:}
\begin{itemize}
    \item Utilização de coordenadas percentuais (0-100\%) ao invés de pixels;
    \item Garantia de responsividade em diferentes tamanhos de tela;
    \item Precisão milimétrica na localização dos pontos;
    \item Compatibilidade com diferentes resoluções de dispositivos.
\end{itemize}

\subsection{Scripts de Migração e Integração}

\textbf{Scripts Python:}
\begin{itemize}
    \item Migração de dados entre formatos (JSON, CSV, SQL);
    \item Validação de integridade dos dados mapeados;
    \item Geração automática de \textit{seeds} para o banco de dados;
    \item Integração com a ferramenta de mapeamento.
\end{itemize}

\section{TECNOLOGIAS DE SUPORTE} \label{sec:suporte}

\subsection{Gerenciamento de Estado (Mobile)}

O gerenciamento de estado global da aplicação é realizado através de bibliotecas modernas que oferecem alta performance e integração nativa com React.

\textbf{Zustand 4.4.7:}

Zustand é uma biblioteca de gerenciamento de estado minimalista baseada em \textit{hooks}, escolhida por sua simplicidade e performance superior. O sistema utiliza cinco \textit{stores} principais:

\begin{itemize}
    \item \textbf{authStore}: Gerencia autenticação via Firebase, armazenamento de tokens JWT e dados do perfil do usuário. Implementa login com email/senha e Google OAuth;
    \item \textbf{pointsStore}: Controla pontos de acupuntura e sistema de favoritos com \textit{optimistic updates} --- a interface atualiza imediatamente enquanto a operação é processada em segundo plano, com \textit{rollback} automático em caso de falha;
    \item \textbf{symptomsStore}: Gerencia lista de sintomas, categorias e relações com pontos de acupuntura;
    \item \textbf{syncStore}: Coordena sincronização \textit{offline}/\textit{online} através de fila de operações (\texttt{sync\_queue}) com controle de conflitos baseado em \textit{timestamp} e \textit{retry} com \textit{exponential backoff};
    \item \textbf{themeStore}: Controla tema visual da aplicação (claro/escuro/sistema) com persistência automática.
\end{itemize}

A persistência do estado é realizada através do \textit{middleware} \texttt{persist} do Zustand, integrado ao AsyncStorage para dados não sensíveis.

\textbf{React Query (@tanstack/react-query) 5.x:}
\begin{itemize}
    \item \textit{Cache} inteligente de requisições HTTP com invalidação automática;
    \item \textit{Refetch} estratégico baseado em foco da janela e reconexão;
    \item Suporte a operações \textit{offline} com sincronização em segundo plano;
    \item Deduplicação automática de requisições simultâneas.
\end{itemize}

\subsection{Ferramenta de Mapeamento de Pontos (Point Mapper)}

O Point Mapper é uma ferramenta web auxiliar desenvolvida em HTML, CSS e JavaScript puro, utilizada para mapear as coordenadas dos pontos de acupuntura sobre as imagens SVG do atlas anatômico.

\textbf{Funcionalidades:}
\begin{itemize}
    \item Seleção de meridiano e ponto a ser mapeado;
    \item Seleção da vista anatômica (anterior, posterior, lateral, etc.);
    \item Clique na imagem para definir coordenadas em formato percentual;
    \item Prévia do marcador na posição selecionada;
    \item Exportação dos mapeamentos em formato JSON.
\end{itemize}

A gestão dos dados do sistema (pontos, sintomas, usuários) é realizada diretamente através das APIs REST protegidas do \textit{backend} e dos consoles administrativos do Firebase e Google Cloud Platform.
