sequenceDiagram
    participant U as Usuario
    participant App as App Mobile
    participant API as Backend API
    participant RAG as RAG Service
    participant AI as Spring AI
    participant Gemini as Gemini 1.5 Flash
    participant DB as Firestore

    U->>App: Abre aba Assistente
    App->>App: Verificar conexao

    alt Sem conexao
        App-->>U: Assistente requer conexao
    else Com conexao
        App-->>U: Exibir interface de chat

        U->>App: Digita pergunta
        U->>App: Envia mensagem
        App-->>U: Exibir indicador digitando

        App->>API: POST /api/assistant/query
        API->>API: Validar e sanitizar entrada

        API->>RAG: Processar com RAG
        RAG->>DB: Buscar pontos relacionados
        DB-->>RAG: Documentos relevantes
        RAG->>RAG: Montar contexto enriquecido

        RAG->>AI: Construir prompt
        AI->>Gemini: Enviar prompt
        Gemini-->>AI: Resposta gerada

        AI->>AI: Extrair codigos de pontos
        AI-->>RAG: Resposta processada
        RAG-->>API: Resultado final

        API->>API: Adicionar disclaimer educacional
        API-->>App: { answer, referencedPoints, disclaimer }

        App-->>U: Exibir resposta e pontos clicaveis
    end
